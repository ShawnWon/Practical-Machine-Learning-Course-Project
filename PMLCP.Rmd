---
title: "Practical Machine Learning Course Project"
author: "Wang Xuezhi"
date: "2019,3,28"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##Synopsis
In this project, the goal is to use data from accelerometers on the belt, forearm, arm, and dumbell of 6 participants. They were asked to perform barbell lifts correctly and incorrectly in 5 different ways,build a model to predict the manner in which they did the exercise. This is the "classe" variable in the training set. 

##Data Source
The training data for this project are available here:
(Training data)[https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv]

The test data are available here:
(Test data)[https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv]

For more information about the Dataset:
(More information about the Dataset)[http://groupware.les.inf.puc-rio.br/har]

##Library and Load the data
```{r}
library(caret)
library(ggplot2)
library(plyr)
Origintraining<-read.csv("pml-training.csv")
Origintesting<-read.csv("pml-testing.csv")
```

##Imputing the data set.

Use preprocess function of "knnImpute" to imputting the origin dataset.

```{r}
ImpObj<-preProcess(Origintraining[,-160],method="knnImpute")
Rtraining<-predict(ImpObj,Origintraining[,-160])
Rtraining$classe<-Origintraining$classe

Rtesting<-predict(ImpObj,Origintesting[,-160])
Rtesting<-data.frame(Rtesting,classe=Origintesting$problem_id)

```


##Data preprocessing
```{r}
numcol<-which(lapply(Rtraining,class)%in%"numeric")
prepro<-preProcess(Rtraining[,numcol],method=c('center','scale'))
trainingpre<-predict(prepro,Rtraining[,numcol])
trainingpre$classe<-Rtraining$classe
##numcol<-which(lapply(Rawtesting,class)%in%"numeric")
##prepro<-preProcess(Rawtesting[,numcol],method=c('knnImpute','center','scale'))
testingpre<-predict(prepro,Rtesting[,numcol])


```

##Removing the non zero Variables
```{r}
Nonzero<-nearZeroVar(trainingpre,saveMetrics=TRUE)
trainingpre1<-trainingpre[,Nonzero$nzv==FALSE]

##Nonzero<-nearZeroVar(testingpre,saveMetrics=TRUE)
##testingpre1<-testingpre[,Nonzero$nzv==FALSE]
```
##PCA analysis

```{r}
prePCA<-preProcess(trainingpre1[,-124],method="pca")
trainPCA<-predict(prePCA,trainingpre1[,-124])
trainPCA<-data.frame(trainPCA,classe=trainingpre1$classe)

testPCA<-predict(prePCA,testingpre[,-124])

```


##Create cross validation set

```{r}
set.seed(1)

inTrain<-createDataPartition(y=trainingpre1$classe,p=.5,list=FALSE)
straining<-trainPCA[-inTrain,]
stesting<-trainPCA[inTrain,]
```

##Train model

Train with tree model, and get the accuracy.
```{r}
modtree<-train(classe~.,method="rpart",data=straining)
treepre<-predict(modtree,straining)
treeaccu<-confusionMatrix(treepre,straining$classe)
treeaccu$overall[1]
```

Train with Randon Forest, and get the accuracy.
```{r}
modrf<-train(classe~.,method="rf",data=straining,trControl=trainControl(method="cv"),number=5,allowParallel=TRUE)
rfpre<-predict(modrf,straining)
rfaccu<-confusionMatrix(rfpre,straining$classe)
rfaccu$overall[1]
```

Train with LDA, and get the accuracy.
```{r}
modlda<-train(classe~.,method="lda",data=straining)
ldapre<-predict(modlda,straining)
ldaaccu<-confusionMatrix(ldapre,straining$classe)
ldaaccu$overall[1]
```

##Cross validation

```{r}
rftes<-predict(modrf,stesting)
CVaccu<-confusionMatrix(rftes,stesting$classe)
CVaccu$overall[1]
```


##Predict on test dataset
```{r}
predict(modrf,testPCA)
```